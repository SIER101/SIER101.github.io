import{_ as fe}from"./@babel-dGVwEr9R.js";import{r as b}from"./react-RkdSbUvv.js";import{L as we,T as Rt,R as Tt,U as Ot,a as kt,O as Le,P as Ae,S as We,b as _e,N as jt,A as Lt,B as At,M as Dt,C as Ft,V as Z,c as It,W as zt,d as Ht,e as Bt,f as Wt,g as $t,h as Nt,i as qt,D as Gt,j as me,k as Ut,l as $e,H as Vt,m as Xt,F as Yt}from"./three-T3ihlJBG.js";import{u as Zt}from"./react-use-measure-_a9B_WOg.js";import{F as Kt,u as Jt}from"./its-fine-gTYvRYz3.js";import{R as Qt,c as ie}from"./react-reconciler-9Me6WKVo.js";import{c as en}from"./react-dom-q8JQoXo5.js";import{c as et}from"./zustand-AJ88xiq_.js";import{m as tn}from"./react-merge-refs-hAbx5P3g.js";import{O as nn}from"./three-stdlib-SRVl_Jc9.js";import{S as rn}from"./stats.js-0AQsEqCA.js";import{s as on,p as sn,c as an}from"./suspend-react-7rE_FwbT.js";var rr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function or(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const ln="modulepreload",cn=function(e){return"/"+e},Ne={},ir=function(t,n,i){if(!n||n.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(n.map(l=>{if(l=cn(l),l in Ne)return;Ne[l]=!0;const h=l.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(!!i)for(let r=s.length-1;r>=0;r--){const o=s[r];if(o.href===l&&(!h||o.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${m}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":ln,h||(g.as="script",g.crossOrigin=""),g.href=l,document.head.appendChild(g),h)return new Promise((r,o)=>{g.addEventListener("load",r),g.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>t()).catch(l=>{const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=l,window.dispatchEvent(h),!h.defaultPrevented)throw l})};var tt={exports:{}},nt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(w,x){var M=w.length;w.push(x);e:for(;0<M;){var O=M-1>>>1,R=w[O];if(0<s(R,x))w[O]=x,w[M]=R,M=O;else break e}}function n(w){return w.length===0?null:w[0]}function i(w){if(w.length===0)return null;var x=w[0],M=w.pop();if(M!==x){w[0]=M;e:for(var O=0,R=w.length,j=R>>>1;O<j;){var $=2*(O+1)-1,F=w[$],U=$+1,X=w[U];if(0>s(F,M))U<R&&0>s(X,F)?(w[O]=X,w[U]=M,O=U):(w[O]=F,w[$]=M,O=$);else if(U<R&&0>s(X,M))w[O]=X,w[U]=M,O=U;else break e}}return x}function s(w,x){var M=w.sortIndex-x.sortIndex;return M!==0?M:w.id-x.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var h=Date,m=h.now();e.unstable_now=function(){return h.now()-m}}var a=[],g=[],r=1,o=null,c=3,d=!1,p=!1,P=!1,v=typeof setTimeout=="function"?setTimeout:null,u=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(w){for(var x=n(g);x!==null;){if(x.callback===null)i(g);else if(x.startTime<=w)i(g),x.sortIndex=x.expirationTime,t(a,x);else break;x=n(g)}}function S(w){if(P=!1,y(w),!p)if(n(a)!==null)p=!0,q(C);else{var x=n(g);x!==null&&B(S,x.startTime-w)}}function C(w,x){p=!1,P&&(P=!1,u(L),L=-1),d=!0;var M=c;try{for(y(x),o=n(a);o!==null&&(!(o.expirationTime>x)||w&&!_());){var O=o.callback;if(typeof O=="function"){o.callback=null,c=o.priorityLevel;var R=O(o.expirationTime<=x);x=e.unstable_now(),typeof R=="function"?o.callback=R:o===n(a)&&i(a),y(x)}else i(a);o=n(a)}if(o!==null)var j=!0;else{var $=n(g);$!==null&&B(S,$.startTime-x),j=!1}return j}finally{o=null,c=M,d=!1}}var E=!1,k=null,L=-1,T=5,D=-1;function _(){return!(e.unstable_now()-D<T)}function A(){if(k!==null){var w=e.unstable_now();D=w;var x=!0;try{x=k(!0,w)}finally{x?W():(E=!1,k=null)}}else E=!1}var W;if(typeof f=="function")W=function(){f(A)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,H=V.port2;V.port1.onmessage=A,W=function(){H.postMessage(null)}}else W=function(){v(A,0)};function q(w){k=w,E||(E=!0,W())}function B(w,x){L=v(function(){w(e.unstable_now())},x)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(w){w.callback=null},e.unstable_continueExecution=function(){p||d||(p=!0,q(C))},e.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<w?Math.floor(1e3/w):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return n(a)},e.unstable_next=function(w){switch(c){case 1:case 2:case 3:var x=3;break;default:x=c}var M=c;c=x;try{return w()}finally{c=M}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(w,x){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var M=c;c=w;try{return x()}finally{c=M}},e.unstable_scheduleCallback=function(w,x,M){var O=e.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?O+M:O):M=O,w){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=M+R,w={id:r++,callback:x,priorityLevel:w,startTime:M,expirationTime:R,sortIndex:-1},M>O?(w.sortIndex=M,t(g,w),n(a)===null&&w===n(g)&&(P?(u(L),L=-1):P=!0,B(S,M-O))):(w.sortIndex=R,t(a,w),p||d||(p=!0,q(C))),w},e.unstable_shouldYield=_,e.unstable_wrapCallback=function(w){var x=c;return function(){var M=c;c=x;try{return w.apply(this,arguments)}finally{c=M}}}})(nt);tt.exports=nt;var qe=tt.exports;const De={},un=e=>void Object.assign(De,e);function fn(e,t){function n(r,{args:o=[],attach:c,...d},p){let P=`${r[0].toUpperCase()}${r.slice(1)}`,v;if(r==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const u=d.object;v=re(u,{type:r,root:p,attach:c,primitive:!0})}else{const u=De[P];if(!u)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");v=re(new u(...o),{type:r,root:p,attach:c,memoizedProps:{args:o}})}return v.__r3f.attach===void 0&&(v instanceof At?v.__r3f.attach="geometry":v instanceof Dt&&(v.__r3f.attach="material")),P!=="inject"&&Ce(v,d),v}function i(r,o){let c=!1;if(o){var d,p;(d=o.__r3f)!=null&&d.attach?Pe(r,o,o.__r3f.attach):o.isObject3D&&r.isObject3D&&(r.add(o),c=!0),c||(p=r.__r3f)==null||p.objects.push(o),o.__r3f||re(o,{}),o.__r3f.parent=r,ke(o),oe(o)}}function s(r,o,c){let d=!1;if(o){var p,P;if((p=o.__r3f)!=null&&p.attach)Pe(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){o.parent=r,o.dispatchEvent({type:"added"});const v=r.children.filter(f=>f!==o),u=v.indexOf(c);r.children=[...v.slice(0,u),o,...v.slice(u)],d=!0}d||(P=r.__r3f)==null||P.objects.push(o),o.__r3f||re(o,{}),o.__r3f.parent=r,ke(o),oe(o)}}function l(r,o,c=!1){r&&[...r].forEach(d=>h(o,d,c))}function h(r,o,c){if(o){var d,p,P;if(o.__r3f&&(o.__r3f.parent=null),(d=r.__r3f)!=null&&d.objects&&(r.__r3f.objects=r.__r3f.objects.filter(S=>S!==o)),(p=o.__r3f)!=null&&p.attach)Ye(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){var v;r.remove(o),(v=o.__r3f)!=null&&v.root&&wn(o.__r3f.root,o)}const f=(P=o.__r3f)==null?void 0:P.primitive,y=!f&&(c===void 0?o.dispose!==null:c);if(!f){var u;l((u=o.__r3f)==null?void 0:u.objects,o,y),l(o.children,o,y)}if(delete o.__r3f,y&&o.dispose&&o.type!=="Scene"){const S=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?qe.unstable_scheduleCallback(qe.unstable_IdlePriority,S):S()}oe(r)}}function m(r,o,c,d){var p;const P=(p=r.__r3f)==null?void 0:p.parent;if(!P)return;const v=n(o,c,r.__r3f.root);if(r.children){for(const u of r.children)u.__r3f&&i(v,u);r.children=r.children.filter(u=>!u.__r3f)}r.__r3f.objects.forEach(u=>i(v,u)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||h(P,r),v.parent&&(v.__r3f.autoRemovedBeforeAppend=!0),i(P,v),v.raycast&&v.__r3f.eventCount&&v.__r3f.root.getState().internal.interaction.push(v),[d,d.alternate].forEach(u=>{u!==null&&(u.stateNode=v,u.ref&&(typeof u.ref=="function"?u.ref(v):u.ref.current=v))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Qt({createInstance:n,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,o)=>{if(!o)return;const c=r.getState().scene;c.__r3f&&(c.__r3f.root=r,i(c,o))},removeChildFromContainer:(r,o)=>{o&&h(r.getState().scene,o)},insertInContainerBefore:(r,o,c)=>{if(!o||!c)return;const d=r.getState().scene;d.__r3f&&s(d,o,c)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var o;return!!((o=r==null?void 0:r.__r3f)!=null?o:{}).handlers},prepareUpdate(r,o,c,d){var p;if(((p=r==null?void 0:r.__r3f)!=null?p:{}).primitive&&d.object&&d.object!==r)return[!0];{const{args:v=[],children:u,...f}=d,{args:y=[],children:S,...C}=c;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((k,L)=>k!==y[L]))return[!0];const E=ct(r,f,C,!0);return E.changes.length?[!1,E]:null}},commitUpdate(r,[o,c],d,p,P,v){o?m(r,d,P,v):Ce(r,c)},commitMount(r,o,c,d){var p;const P=(p=r.__r3f)!=null?p:{};r.raycast&&P.handlers&&P.eventCount&&r.__r3f.root.getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>re(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var o;const{attach:c,parent:d}=(o=r.__r3f)!=null?o:{};c&&d&&Ye(d,r,c),r.isObject3D&&(r.visible=!1),oe(r)},unhideInstance(r,o){var c;const{attach:d,parent:p}=(c=r.__r3f)!=null?c:{};d&&p&&Pe(p,r,d),(r.isObject3D&&o.visible==null||o.visible)&&(r.visible=!0),oe(r)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():ie.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&z.fun(performance.now)?performance.now:z.fun(Date.now)?Date.now:()=>0,scheduleTimeout:z.fun(setTimeout)?setTimeout:void 0,cancelTimeout:z.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ce}}var Ge,Ue;const Ee=e=>"colorSpace"in e||"outputColorSpace"in e,rt=()=>{var e;return(e=De.ColorManagement)!=null?e:null},ot=e=>e&&e.isOrthographicCamera,dn=e=>e&&e.hasOwnProperty("current"),de=typeof window<"u"&&((Ge=window.document)!=null&&Ge.createElement||((Ue=window.navigator)==null?void 0:Ue.product)==="ReactNative")?b.useLayoutEffect:b.useEffect;function it(e){const t=b.useRef(e);return de(()=>void(t.current=e),[e]),t}function pn({set:e}){return de(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class st extends b.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}st.getDerivedStateFromError=()=>({error:!0});const at="__default",Ve=new Map,vn=e=>e&&!!e.memoized&&!!e.changes;function lt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const le=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},z={obj:e=>e===Object(e)&&!z.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(z.str(e)||z.num(e))return e===t;const l=z.obj(e);if(l&&i==="reference")return e===t;const h=z.arr(e);if(h&&n==="reference")return e===t;if((h||l)&&e===t)return!0;let m;for(m in e)if(!(m in t))return!1;if(l&&n==="shallow"&&i==="shallow"){for(m in s?t:e)if(!z.equ(e[m],t[m],{strict:s,objects:"reference"}))return!1}else for(m in s?t:e)if(e[m]!==t[m])return!1;if(z.und(m)){if(h&&e.length===0&&t.length===0||l&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function mn(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function hn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function re(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Oe(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return n=i.reduce((l,h)=>l[h],e),{target:n,key:s}}else return{target:n,key:t}}const Xe=/-\d+$/;function Pe(e,t,n){if(z.str(n)){if(Xe.test(n)){const l=n.replace(Xe,""),{target:h,key:m}=Oe(e,l);Array.isArray(h[m])||(h[m]=[])}const{target:i,key:s}=Oe(e,n);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=n(e,t)}function Ye(e,t,n){var i,s;if(z.str(n)){const{target:l,key:h}=Oe(e,n),m=t.__r3f.previousAttach;m===void 0?delete l[h]:l[h]=m}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function ct(e,{children:t,key:n,ref:i,...s},{children:l,key:h,ref:m,...a}={},g=!1){var r;const o=(r=e==null?void 0:e.__r3f)!=null?r:{},c=Object.entries(s),d=[];if(g){const P=Object.keys(a);for(let v=0;v<P.length;v++)s.hasOwnProperty(P[v])||c.unshift([P[v],at+"remove"])}c.forEach(([P,v])=>{var u;if((u=e.__r3f)!=null&&u.primitive&&P==="object"||z.equ(v,a[P]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(P))return d.push([P,v,!0,[]]);let f=[];P.includes("-")&&(f=P.split("-")),d.push([P,v,!1,f]);for(const y in s){const S=s[y];y.startsWith(`${P}-`)&&d.push([y,S,!1,y.split("-")])}});const p={...s};return o.memoizedProps&&o.memoizedProps.args&&(p.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(p.attach=o.memoizedProps.attach),{memoized:p,changes:d}}const gn=typeof process<"u"&&!1;function Ce(e,t){var n,i,s;const l=(n=e.__r3f)!=null?n:{},h=l.root,m=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:a,changes:g}=vn(t)?t:ct(e,t),r=l.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let c=0;c<g.length;c++){let[d,p,P,v]=g[c];if(Ee(e)){const S="srgb",C="srgb-linear";d==="encoding"?(d="colorSpace",p=p===3001?S:C):d==="outputEncoding"&&(d="outputColorSpace",p=p===3001?S:C)}let u=e,f=u[d];if(v.length&&(f=v.reduce((y,S)=>y[S],e),!(f&&f.set))){const[y,...S]=v.reverse();u=S.reverse().reduce((C,E)=>C[E],e),d=y}if(p===at+"remove")if(u.constructor){let y=Ve.get(u.constructor);y||(y=new u.constructor,Ve.set(u.constructor,y)),p=y[d]}else p=0;if(P)p?l.handlers[d]=p:delete l.handlers[d],l.eventCount=Object.keys(l.handlers).length;else if(f&&f.set&&(f.copy||f instanceof we)){if(Array.isArray(p))f.fromArray?f.fromArray(p):f.set(...p);else if(f.copy&&p&&p.constructor&&(gn?f.constructor.name===p.constructor.name:f.constructor===p.constructor))f.copy(p);else if(p!==void 0){const y=f instanceof Ft;!y&&f.setScalar?f.setScalar(p):f instanceof we&&p instanceof we?f.mask=p.mask:f.set(p),!rt()&&!m.linear&&y&&f.convertSRGBToLinear()}}else if(u[d]=p,u[d]instanceof Rt&&u[d].format===Tt&&u[d].type===Ot){const y=u[d];Ee(y)&&Ee(m.gl)?y.colorSpace=m.gl.outputColorSpace:y.encoding=m.gl.outputEncoding}oe(e)}if(l.parent&&m.internal&&e.raycast&&r!==l.eventCount){const c=m.internal.interaction.indexOf(e);c>-1&&m.internal.interaction.splice(c,1),l.eventCount&&m.internal.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(s=e.__r3f)!=null&&s.parent&&ke(e),e}function oe(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function ke(e){e.onUpdate==null||e.onUpdate(e)}function yn(e,t){e.manual||(ot(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function he(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function bn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ie.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ie.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ie.ContinuousEventPriority;default:return ie.DefaultEventPriority}}function ut(e,t,n,i){const s=n.get(t);s&&(n.delete(t),n.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function wn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(s)}),n.capturedMap.forEach((i,s)=>{ut(n.capturedMap,t,i,s)})}function _n(e){function t(a){const{internal:g}=e.getState(),r=a.offsetX-g.initialClick[0],o=a.offsetY-g.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}function n(a){return a.filter(g=>["Move","Over","Enter","Out","Leave"].some(r=>{var o;return(o=g.__r3f)==null?void 0:o.handlers["onPointer"+r]}))}function i(a,g){const r=e.getState(),o=new Set,c=[],d=g?g(r.internal.interaction):r.internal.interaction;for(let u=0;u<d.length;u++){const f=le(d[u]);f&&(f.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(a,r);function p(u){const f=le(u);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var y;f.events.compute==null||f.events.compute(a,f,(y=f.previousRoot)==null?void 0:y.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(u,!0):[]}let P=d.flatMap(p).sort((u,f)=>{const y=le(u.object),S=le(f.object);return!y||!S?u.distance-f.distance:S.events.priority-y.events.priority||u.distance-f.distance}).filter(u=>{const f=he(u);return o.has(f)?!1:(o.add(f),!0)});r.events.filter&&(P=r.events.filter(P,r));for(const u of P){let f=u.object;for(;f;){var v;(v=f.__r3f)!=null&&v.eventCount&&c.push({...u,eventObject:f}),f=f.parent}}if("pointerId"in a&&r.internal.capturedMap.has(a.pointerId))for(let u of r.internal.capturedMap.get(a.pointerId).values())o.has(he(u.intersection))||c.push(u.intersection);return c}function s(a,g,r,o){const c=e.getState();if(a.length){const d={stopped:!1};for(const p of a){const P=le(p.object)||c,{raycaster:v,pointer:u,camera:f,internal:y}=P,S=new Z(u.x,u.y,0).unproject(f),C=D=>{var _,A;return(_=(A=y.capturedMap.get(D))==null?void 0:A.has(p.eventObject))!=null?_:!1},E=D=>{const _={intersection:p,target:g.target};y.capturedMap.has(D)?y.capturedMap.get(D).set(p.eventObject,_):y.capturedMap.set(D,new Map([[p.eventObject,_]])),g.target.setPointerCapture(D)},k=D=>{const _=y.capturedMap.get(D);_&&ut(y.capturedMap,p.eventObject,_,D)};let L={};for(let D in g){let _=g[D];typeof _!="function"&&(L[D]=_)}let T={...p,...L,pointer:u,intersections:a,stopped:d.stopped,delta:r,unprojectedPoint:S,ray:v.ray,camera:f,stopPropagation(){const D="pointerId"in g&&y.capturedMap.get(g.pointerId);if((!D||D.has(p.eventObject))&&(T.stopped=d.stopped=!0,y.hovered.size&&Array.from(y.hovered.values()).find(_=>_.eventObject===p.eventObject))){const _=a.slice(0,a.indexOf(p));l([..._,p])}},target:{hasPointerCapture:C,setPointerCapture:E,releasePointerCapture:k},currentTarget:{hasPointerCapture:C,setPointerCapture:E,releasePointerCapture:k},nativeEvent:g};if(o(T),d.stopped===!0)break}}return a}function l(a){const{internal:g}=e.getState();for(const r of g.hovered.values())if(!a.length||!a.find(o=>o.object===r.object&&o.index===r.index&&o.instanceId===r.instanceId)){const c=r.eventObject.__r3f,d=c==null?void 0:c.handlers;if(g.hovered.delete(he(r)),c!=null&&c.eventCount){const p={...r,intersections:a};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function h(a,g){for(let r=0;r<g.length;r++){const o=g[r].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(a)}}function m(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>l([]);case"onLostPointerCapture":return g=>{const{internal:r}=e.getState();"pointerId"in g&&r.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(g.pointerId)&&(r.capturedMap.delete(g.pointerId),l([]))})}}return function(r){const{onPointerMissed:o,internal:c}=e.getState();c.lastEvent.current=r;const d=a==="onPointerMove",p=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",v=i(r,d?n:void 0),u=p?t(r):0;a==="onPointerDown"&&(c.initialClick=[r.offsetX,r.offsetY],c.initialHits=v.map(y=>y.eventObject)),p&&!v.length&&u<=2&&(h(r,c.interaction),o&&o(r)),d&&l(v);function f(y){const S=y.eventObject,C=S.__r3f,E=C==null?void 0:C.handlers;if(C!=null&&C.eventCount)if(d){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const k=he(y),L=c.hovered.get(k);L?L.stopped&&y.stopPropagation():(c.hovered.set(k,y),E.onPointerOver==null||E.onPointerOver(y),E.onPointerEnter==null||E.onPointerEnter(y))}E.onPointerMove==null||E.onPointerMove(y)}else{const k=E[a];k?(!p||c.initialHits.includes(S))&&(h(r,c.interaction.filter(L=>!c.initialHits.includes(L))),k(y)):p&&c.initialHits.includes(S)&&h(r,c.interaction.filter(L=>!c.initialHits.includes(L)))}}s(v,r,u,f)}}return{handlePointer:m}}const ft=e=>!!(e!=null&&e.render),dt=b.createContext(null),En=(e,t)=>{const n=et((m,a)=>{const g=new Z,r=new Z,o=new Z;function c(u=a().camera,f=r,y=a().size){const{width:S,height:C,top:E,left:k}=y,L=S/C;f instanceof Z?o.copy(f):o.set(...f);const T=u.getWorldPosition(g).distanceTo(o);if(ot(u))return{width:S/u.zoom,height:C/u.zoom,top:E,left:k,factor:1,distance:T,aspect:L};{const D=u.fov*Math.PI/180,_=2*Math.tan(D/2)*T,A=_*(S/C);return{width:A,height:_,top:E,left:k,factor:S/A,distance:T,aspect:L}}}let d;const p=u=>m(f=>({performance:{...f.performance,current:u}})),P=new It;return{set:m,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(u=1)=>e(a(),u),advance:(u,f)=>t(u,f,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Nt,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const u=a();d&&clearTimeout(d),u.performance.current!==u.performance.min&&p(u.performance.min),d=setTimeout(()=>p(a().performance.max),u.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:u=>m(f=>({...f,events:{...f.events,...u}})),setSize:(u,f,y,S,C)=>{const E=a().camera,k={width:u,height:f,top:S||0,left:C||0,updateStyle:y};m(L=>({size:k,viewport:{...L.viewport,...c(E,r,k)}}))},setDpr:u=>m(f=>{const y=lt(u);return{viewport:{...f.viewport,dpr:y,initialDpr:f.viewport.initialDpr||y}}}),setFrameloop:(u="always")=>{const f=a().clock;f.stop(),f.elapsedTime=0,u!=="never"&&(f.start(),f.elapsedTime=0),m(()=>({frameloop:u}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:b.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(u,f,y)=>{const S=a().internal;return S.priority=S.priority+(f>0?1:0),S.subscribers.push({ref:u,priority:f,store:y}),S.subscribers=S.subscribers.sort((C,E)=>C.priority-E.priority),()=>{const C=a().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(f>0?1:0),C.subscribers=C.subscribers.filter(E=>E.ref!==u))}}}}}),i=n.getState();let s=i.size,l=i.viewport.dpr,h=i.camera;return n.subscribe(()=>{const{camera:m,size:a,viewport:g,gl:r,set:o}=n.getState();if(a.width!==s.width||a.height!==s.height||g.dpr!==l){var c;s=a,l=g.dpr,yn(m,a),r.setPixelRatio(g.dpr);const d=(c=a.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(a.width,a.height,d)}m!==h&&(h=m,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(m)}})))}),n.subscribe(m=>e(m)),n};function pt(e,t){const n={callback:e};return t.add(n),()=>void t.delete(n)}let ge,vt=new Set,mt=new Set,Pn=new Set;const Cn=e=>pt(e,vt),Sn=e=>pt(e,mt);function Se(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function ce(e,t){switch(e){case"before":return Se(vt,t);case"after":return Se(mt,t);case"tail":return Se(Pn,t)}}let Me,xe;function Re(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Me=t.internal.subscribers,ge=0;ge<Me.length;ge++)xe=Me[ge],xe.ref.current(xe.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Mn(e){let t=!1,n,i,s;function l(a){i=requestAnimationFrame(l),t=!0,n=0,ce("before",a);for(const r of e.values()){var g;s=r.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((g=s.gl.xr)!=null&&g.isPresenting)&&(n+=Re(a,s))}if(ce("after",a),n===0)return ce("tail",a),t=!1,cancelAnimationFrame(i)}function h(a,g=1){var r;if(!a)return e.forEach(o=>h(o.store.getState()),g);(r=a.gl.xr)!=null&&r.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+g),t||(t=!0,requestAnimationFrame(l)))}function m(a,g=!0,r,o){if(g&&ce("before",a),r)Re(a,r,o);else for(const c of e.values())Re(a,c.store.getState());g&&ce("after",a)}return{loop:l,invalidate:h,advance:m}}function ht(){const e=b.useContext(dt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function N(e=n=>n,t){return ht()(e,t)}function Fe(e,t=0){const n=ht(),i=n.getState().internal.subscribe,s=it(e);return de(()=>i(s,t,n),[t,i,n]),null}const Ze=new WeakMap;function gt(e,t){return function(n,...i){let s=Ze.get(n);return s||(s=new n,Ze.set(n,s)),e&&e(s),Promise.all(i.map(l=>new Promise((h,m)=>s.load(l,a=>{a.scene&&Object.assign(a,mn(a.scene)),h(a)},t,a=>m(new Error(`Could not load ${l}: ${a==null?void 0:a.message}`)))))).finally(()=>s.dispose==null?void 0:s.dispose())}}function yt(e,t,n,i){const s=Array.isArray(t)?t:[t],l=on(gt(n,i),[e,...s],{equal:z.equ});return Array.isArray(t)?l:l[0]}yt.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return sn(gt(n),[e,...i])};yt.clear=function(e,t){const n=Array.isArray(t)?t:[t];return an([e,...n])};const se=new Map,{invalidate:Ke,advance:Je}=Mn(se),{reconciler:ye,applyProps:te}=fn(se,bn),ne={objects:"shallow",strict:!1},xn=(e,t)=>{const n=typeof e=="function"?e(t):e;return ft(n)?n:new zt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Rn(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:s,top:l,left:h,updateStyle:m=n}=t;return{width:i,height:s,top:l,left:h,updateStyle:m}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:s,top:l,left:h}=e.parentElement.getBoundingClientRect();return{width:i,height:s,top:l,left:h,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function Tn(e){const t=se.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,l=i||En(Ke,Je),h=n||ye.createContainer(l,ie.ConcurrentRoot,null,!1,null,"",s,null);t||se.set(e,{fiber:h,store:l});let m,a=!1,g;return{configure(r={}){let{gl:o,size:c,scene:d,events:p,onCreated:P,shadows:v=!1,linear:u=!1,flat:f=!1,legacy:y=!1,orthographic:S=!1,frameloop:C="always",dpr:E=[1,2],performance:k,raycaster:L,camera:T,onPointerMissed:D}=r,_=l.getState(),A=_.gl;_.gl||_.set({gl:A=xn(o,e)});let W=_.raycaster;W||_.set({raycaster:W=new kt});const{params:V,...H}=L||{};if(z.equ(H,W,ne)||te(W,{...H}),z.equ(V,W.params,ne)||te(W,{params:{...W.params,...V}}),!_.camera||_.camera===g&&!z.equ(g,T,ne)){g=T;const R=T instanceof Ht,j=R?T:S?new Le(0,0,0,0,.1,1e3):new Ae(75,0,.1,1e3);R||(j.position.z=5,T&&te(j,T),!_.camera&&!(T!=null&&T.rotation)&&j.lookAt(0,0,0)),_.set({camera:j}),W.camera=j}if(!_.scene){let R;d instanceof We?R=d:(R=new We,d&&te(R,d)),_.set({scene:re(R)})}if(!_.xr){var q;const R=(F,U)=>{const X=l.getState();X.frameloop!=="never"&&Je(F,!0,X,U)},j=()=>{const F=l.getState();F.gl.xr.enabled=F.gl.xr.isPresenting,F.gl.xr.setAnimationLoop(F.gl.xr.isPresenting?R:null),F.gl.xr.isPresenting||Ke(F)},$={connect(){const F=l.getState().gl;F.xr.addEventListener("sessionstart",j),F.xr.addEventListener("sessionend",j)},disconnect(){const F=l.getState().gl;F.xr.removeEventListener("sessionstart",j),F.xr.removeEventListener("sessionend",j)}};typeof((q=A.xr)==null?void 0:q.addEventListener)=="function"&&$.connect(),_.set({xr:$})}if(A.shadowMap){const R=A.shadowMap.enabled,j=A.shadowMap.type;if(A.shadowMap.enabled=!!v,z.boo(v))A.shadowMap.type=_e;else if(z.str(v)){var B;const $={basic:Bt,percentage:Wt,soft:_e,variance:$t};A.shadowMap.type=(B=$[v])!=null?B:_e}else z.obj(v)&&Object.assign(A.shadowMap,v);(R!==A.shadowMap.enabled||j!==A.shadowMap.type)&&(A.shadowMap.needsUpdate=!0)}const w=rt();w&&("enabled"in w?w.enabled=!y:"legacyMode"in w&&(w.legacyMode=y)),te(A,{outputEncoding:u?3e3:3001,toneMapping:f?jt:Lt}),_.legacy!==y&&_.set(()=>({legacy:y})),_.linear!==u&&_.set(()=>({linear:u})),_.flat!==f&&_.set(()=>({flat:f})),o&&!z.fun(o)&&!ft(o)&&!z.equ(o,A,ne)&&te(A,o),p&&!_.events.handlers&&_.set({events:p(l)});const O=Rn(e,c);return z.equ(O,_.size,ne)||_.setSize(O.width,O.height,O.updateStyle,O.top,O.left),E&&_.viewport.dpr!==lt(E)&&_.setDpr(E),_.frameloop!==C&&_.setFrameloop(C),_.onPointerMissed||_.set({onPointerMissed:D}),k&&!z.equ(k,_.performance,ne)&&_.set(R=>({performance:{...R.performance,...k}})),m=P,a=!0,this},render(r){return a||this.configure(),ye.updateContainer(b.createElement(On,{store:l,children:r,onCreated:m,rootElement:e}),h,null,()=>{}),l},unmount(){bt(e)}}}function On({store:e,children:t,onCreated:n,rootElement:i}){return de(()=>{const s=e.getState();s.set(l=>({internal:{...l.internal,active:!0}})),n&&n(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),b.createElement(dt.Provider,{value:e},t)}function bt(e,t){const n=se.get(e),i=n==null?void 0:n.fiber;if(i){const s=n==null?void 0:n.store.getState();s&&(s.internal.active=!1),ye.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var l,h,m,a;s.events.disconnect==null||s.events.disconnect(),(l=s.gl)==null||(h=l.renderLists)==null||h.dispose==null||h.dispose(),(m=s.gl)==null||m.forceContextLoss==null||m.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),hn(s),se.delete(e),t&&t(e)}catch{}},500)})}}ye.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:b.version});const Te={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function kn(e){const{handlePointer:t}=_n(e);return{priority:1,enabled:!0,compute(n,i,s){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Te).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:s}=e.getState();(n=s.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:n=>{var i;const{set:s,events:l}=e.getState();l.disconnect==null||l.disconnect(),s(h=>({events:{...h.events,connected:n}})),Object.entries((i=l.handlers)!=null?i:[]).forEach(([h,m])=>{const[a,g]=Te[h];n.addEventListener(a,m,{passive:g})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([l,h])=>{if(i&&i.connected instanceof HTMLElement){const[m]=Te[l];i.connected.removeEventListener(m,h)}}),n(l=>({events:{...l.events,connected:void 0}}))}}}}const jn=b.forwardRef(function({children:t,fallback:n,resize:i,style:s,gl:l,events:h=kn,eventSource:m,eventPrefix:a,shadows:g,linear:r,flat:o,legacy:c,orthographic:d,frameloop:p,dpr:P,performance:v,raycaster:u,camera:f,scene:y,onPointerMissed:S,onCreated:C,...E},k){b.useMemo(()=>un(qt),[]);const L=Jt(),[T,D]=Zt({scroll:!0,debounce:{scroll:50,resize:0},...i}),_=b.useRef(null),A=b.useRef(null);b.useImperativeHandle(k,()=>_.current);const W=it(S),[V,H]=b.useState(!1),[q,B]=b.useState(!1);if(V)throw V;if(q)throw q;const w=b.useRef(null);de(()=>{const M=_.current;D.width>0&&D.height>0&&M&&(w.current||(w.current=Tn(M)),w.current.configure({gl:l,events:h,shadows:g,linear:r,flat:o,legacy:c,orthographic:d,frameloop:p,dpr:P,performance:v,raycaster:u,camera:f,scene:y,size:D,onPointerMissed:(...O)=>W.current==null?void 0:W.current(...O),onCreated:O=>{O.events.connect==null||O.events.connect(m?dn(m)?m.current:m:A.current),a&&O.setEvents({compute:(R,j)=>{const $=R[a+"X"],F=R[a+"Y"];j.pointer.set($/j.size.width*2-1,-(F/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),C==null||C(O)}}),w.current.render(b.createElement(L,null,b.createElement(st,{set:B},b.createElement(b.Suspense,{fallback:b.createElement(pn,{set:H})},t)))))}),b.useEffect(()=>{const M=_.current;if(M)return()=>bt(M)},[]);const x=m?"none":"auto";return b.createElement("div",fe({ref:A,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:x,...s}},E),b.createElement("div",{ref:T,style:{width:"100%",height:"100%"}},b.createElement("canvas",{ref:_,style:{display:"block"}},n)))}),sr=b.forwardRef(function(t,n){return b.createElement(Kt,null,b.createElement(jn,fe({},t,{ref:n})))}),pe=new Z,Ie=new Z,Ln=new Z;function An(e,t,n){const i=pe.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=n.width/2,l=n.height/2;return[i.x*s+s,-(i.y*l)+l]}function Dn(e,t){const n=pe.setFromMatrixPosition(e.matrixWorld),i=Ie.setFromMatrixPosition(t.matrixWorld),s=n.sub(i),l=t.getWorldDirection(Ln);return s.angleTo(l)>Math.PI/2}function Fn(e,t,n,i){const s=pe.setFromMatrixPosition(e.matrixWorld),l=s.clone();l.project(t),n.setFromCamera(l,t);const h=n.intersectObjects(i,!0);if(h.length){const m=h[0].distance;return s.distanceTo(n.ray.origin)<m}return!0}function In(e,t){if(t instanceof Le)return t.zoom;if(t instanceof Ae){const n=pe.setFromMatrixPosition(e.matrixWorld),i=Ie.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,l=n.distanceTo(i);return 1/(2*Math.tan(s/2)*l)}else return 1}function zn(e,t,n){if(t instanceof Ae||t instanceof Le){const i=pe.setFromMatrixPosition(e.matrixWorld),s=Ie.setFromMatrixPosition(t.matrixWorld),l=i.distanceTo(s),h=(n[1]-n[0])/(t.far-t.near),m=n[1]-h*t.far;return Math.round(h*l+m)}}const je=e=>Math.abs(e)<1e-10?0:e;function wt(e,t,n=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=je(t[s]*e.elements[s])+(s!==15?",":")");return n+i}const Hn=(e=>t=>wt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Bn=(e=>(t,n)=>wt(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Wn(e){return e&&typeof e=="object"&&"current"in e}const ar=b.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:s,center:l,fullscreen:h,portal:m,distanceFactor:a,sprite:g=!1,transform:r=!1,occlude:o,onOcclude:c,castShadow:d,receiveShadow:p,material:P,geometry:v,zIndexRange:u=[16777271,0],calculatePosition:f=An,as:y="div",wrapperClass:S,pointerEvents:C="auto",...E},k)=>{const{gl:L,camera:T,scene:D,size:_,raycaster:A,events:W,viewport:V}=N(),[H]=b.useState(()=>document.createElement(y)),q=b.useRef(),B=b.useRef(null),w=b.useRef(0),x=b.useRef([0,0]),M=b.useRef(null),O=b.useRef(null),R=(m==null?void 0:m.current)||W.connected||L.domElement.parentNode,j=b.useRef(null),$=b.useRef(!1),F=b.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Wn(o[0]),[o]);b.useLayoutEffect(()=>{const G=L.domElement;o&&o==="blending"?(G.style.zIndex=`${Math.floor(u[0]/2)}`,G.style.position="absolute",G.style.pointerEvents="none"):(G.style.zIndex=null,G.style.position=null,G.style.pointerEvents=null)},[o]),b.useLayoutEffect(()=>{if(B.current){const G=q.current=en(H);if(D.updateMatrixWorld(),r)H.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const I=f(B.current,T,_);H.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${I[0]}px,${I[1]}px,0);transform-origin:0 0;`}return R&&(s?R.prepend(H):R.appendChild(H)),()=>{R&&R.removeChild(H),G.unmount()}}},[R,r]),b.useLayoutEffect(()=>{S&&(H.className=S)},[S]);const U=b.useMemo(()=>r?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:l?"translate3d(-50%,-50%,0)":"none",...h&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...n},[n,l,h,_,r]),X=b.useMemo(()=>({position:"absolute",pointerEvents:C}),[C]);b.useLayoutEffect(()=>{if($.current=!1,r){var G;(G=q.current)==null||G.render(b.createElement("div",{ref:M,style:U},b.createElement("div",{ref:O,style:X},b.createElement("div",{ref:k,className:i,style:n,children:e}))))}else{var I;(I=q.current)==null||I.render(b.createElement("div",{ref:k,style:U,className:i,children:e}))}});const ee=b.useRef(!0);Fe(G=>{if(B.current){T.updateMatrixWorld(),B.current.updateWorldMatrix(!0,!1);const I=r?x.current:f(B.current,T,_);if(r||Math.abs(w.current-T.zoom)>t||Math.abs(x.current[0]-I[0])>t||Math.abs(x.current[1]-I[1])>t){const K=Dn(B.current,T);let Y=!1;F&&(Array.isArray(o)?Y=o.map(J=>J.current):o!=="blending"&&(Y=[D]));const ae=ee.current;if(Y){const J=Fn(B.current,T,A,Y);ee.current=J&&!K}else ee.current=!K;ae!==ee.current&&(c?c(!ee.current):H.style.display=ee.current?"block":"none");const ve=Math.floor(u[0]/2),_t=o?F?[u[0],ve]:[ve-1,0]:u;if(H.style.zIndex=`${zn(B.current,T,_t)}`,r){const[J,He]=[_.width/2,_.height/2],be=T.projectionMatrix.elements[5]*He,{isOrthographicCamera:Be,top:Et,left:Pt,bottom:Ct,right:St}=T,Mt=Hn(T.matrixWorldInverse),xt=Be?`scale(${be})translate(${je(-(St+Pt)/2)}px,${je((Et+Ct)/2)}px)`:`translateZ(${be}px)`;let Q=B.current.matrixWorld;g&&(Q=T.matrixWorldInverse.clone().transpose().copyPosition(Q).scale(B.current.scale),Q.elements[3]=Q.elements[7]=Q.elements[11]=0,Q.elements[15]=1),H.style.width=_.width+"px",H.style.height=_.height+"px",H.style.perspective=Be?"":`${be}px`,M.current&&O.current&&(M.current.style.transform=`${xt}${Mt}translate(${J}px,${He}px)`,O.current.style.transform=Bn(Q,1/((a||10)/400)))}else{const J=a===void 0?1:In(B.current,T)*a;H.style.transform=`translate3d(${I[0]}px,${I[1]}px,0) scale(${J})`}x.current=I,w.current=T.zoom}}if(!F&&j.current&&!$.current)if(r){if(M.current){const I=M.current.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const{isOrthographicCamera:K}=T;if(K||v)E.scale&&(Array.isArray(E.scale)?E.scale instanceof Z?j.current.scale.copy(E.scale.clone().divideScalar(1)):j.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):j.current.scale.setScalar(1/E.scale));else{const Y=(a||10)/400,ae=I.clientWidth*Y,ve=I.clientHeight*Y;j.current.scale.set(ae,ve,1)}$.current=!0}}}else{const I=H.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const K=1/V.factor,Y=I.clientWidth*K,ae=I.clientHeight*K;j.current.scale.set(Y,ae,1),$.current=!0}j.current.lookAt(G.camera.position)}});const ze=b.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return b.createElement("group",fe({},E,{ref:B}),o&&!F&&b.createElement("mesh",{castShadow:d,receiveShadow:p,ref:j},v||b.createElement("planeGeometry",null),P||b.createElement("shaderMaterial",{side:Gt,vertexShader:ze.vertexShader,fragmentShader:ze.fragmentShader})))});let ue=0;const lr=et(e=>(me.onStart=(t,n,i)=>{e({active:!0,item:t,loaded:n,total:i,progress:(n-ue)/(i-ue)*100})},me.onLoad=()=>{e({active:!1})},me.onError=t=>e(n=>({errors:[...n.errors,t]})),me.onProgress=(t,n,i)=>{n===i&&(ue=i),e({active:!0,item:t,loaded:n,total:i,progress:(n-ue)/(i-ue)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function $n(e,t,n){const i=N(c=>c.size),s=N(c=>c.viewport),l=typeof e=="number"?e:i.width*s.dpr,h=typeof t=="number"?t:i.height*s.dpr,m=(typeof e=="number"?n:e)||{},{samples:a=0,depth:g,...r}=m,o=b.useMemo(()=>{const c=new Ut(l,h,{minFilter:$e,magFilter:$e,type:Vt,...r});return g&&(c.depthTexture=new Xt(l,h,Yt)),c.samples=a,c},[]);return b.useLayoutEffect(()=>{o.setSize(l,h),a&&(o.samples=a)},[a,o,l,h]),b.useEffect(()=>()=>o.dispose(),[]),o}const Nn=e=>typeof e=="function",cr=b.forwardRef(({envMap:e,resolution:t=256,frames:n=1/0,makeDefault:i,children:s,...l},h)=>{const m=N(({set:v})=>v),a=N(({camera:v})=>v),g=N(({size:v})=>v),r=b.useRef(null),o=b.useRef(null),c=$n(t);b.useLayoutEffect(()=>{l.manual||(r.current.aspect=g.width/g.height)},[g,l]),b.useLayoutEffect(()=>{r.current.updateProjectionMatrix()});let d=0,p=null;const P=Nn(s);return Fe(v=>{P&&(n===1/0||d<n)&&(o.current.visible=!1,v.gl.setRenderTarget(c),p=v.scene.background,e&&(v.scene.background=e),v.gl.render(v.scene,r.current),v.scene.background=p,v.gl.setRenderTarget(null),o.current.visible=!0,d++)}),b.useLayoutEffect(()=>{if(i){const v=a;return m(()=>({camera:r.current})),()=>m(()=>({camera:v}))}},[r,i,m]),b.createElement(b.Fragment,null,b.createElement("perspectiveCamera",fe({ref:tn([r,h])},l),!P&&s),b.createElement("group",{ref:o},P&&s(c.texture)))}),ur=b.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:i,enableDamping:s=!0,keyEvents:l=!1,onChange:h,onStart:m,onEnd:a,...g},r)=>{const o=N(E=>E.invalidate),c=N(E=>E.camera),d=N(E=>E.gl),p=N(E=>E.events),P=N(E=>E.setEvents),v=N(E=>E.set),u=N(E=>E.get),f=N(E=>E.performance),y=t||c,S=i||p.connected||d.domElement,C=b.useMemo(()=>new nn(y),[y]);return Fe(()=>{C.enabled&&C.update()},-1),b.useEffect(()=>(l&&C.connect(l===!0?S:l),C.connect(S),()=>void C.dispose()),[l,S,n,C,o]),b.useEffect(()=>{const E=T=>{o(),n&&f.regress(),h&&h(T)},k=T=>{m&&m(T)},L=T=>{a&&a(T)};return C.addEventListener("change",E),C.addEventListener("start",k),C.addEventListener("end",L),()=>{C.removeEventListener("start",k),C.removeEventListener("end",L),C.removeEventListener("change",E)}},[h,m,a,C,o,P]),b.useEffect(()=>{if(e){const E=u().controls;return v({controls:C}),()=>v({controls:E})}},[e,C]),b.createElement("primitive",fe({ref:r,object:C,enableDamping:s},g))});function Qe(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function qn(e,t=[],n){const[i,s]=b.useState();return b.useLayoutEffect(()=>{const l=e();return s(l),Qe(n,l),()=>Qe(n,null)},t),i}function fr({showPanel:e=0,className:t,parent:n}){const i=qn(()=>new rn,[]);return b.useEffect(()=>{if(i){const s=n&&n.current||document.body;i.showPanel(e),s==null||s.appendChild(i.dom),t&&i.dom.classList.add(...t.split(" ").filter(m=>m));const l=Cn(()=>i.begin()),h=Sn(()=>i.end());return()=>{s==null||s.removeChild(i.dom),l(),h()}}},[n,i,t,e]),null}export{sr as C,ar as H,ur as O,cr as P,fr as S,ir as _,N as a,yt as b,rr as c,or as g,lr as u};
